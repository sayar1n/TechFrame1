# Система управления дефектами (Defect Management System)

## Описание проекта

Монолитное веб-приложение для централизованного управления дефектами на строительных объектах. Система обеспечивает полный цикл работы с дефектами, от регистрации и назначения исполнителя до контроля статусов и формирования отчётности для руководства.

### Цель

Сокращение потерь информации, повышение прозрачности работы и обеспечение единого инструмента взаимодействия между инженерами, менеджерами и заказчиками на строительных объектах.

### Пользовательские роли

*   **Менеджер:** Назначение задач, контроль сроков, формирование отчётов, полное управление проектами и дефектами.
*   **Инженер:** Регистрация дефектов, обновление информации по дефектам, добавление комментариев и вложений.
*   **Наблюдатель:** Просмотр прогресса и отчётности, без возможности внесения изменений.

## Технологии

*   **Фронтенд:** Next.js (React Framework) с SCSS для стилизации.
*   **Бэкенд:** FastAPI (Python) для построения RESTful API.
*   **База данных:** SQLite (легковесная, файловая реляционная база данных).
*   **ORM:** SQLAlchemy для взаимодействия с базой данных.
*   **Аутентификация:** JWT (JSON Web Tokens) для безопасной аутентификации и авторизации.
*   **Хеширование паролей:** `bcrypt` (через `passlib`).

## Структура проекта

```
. # Корневой каталог проекта
├── backend/             # Каталог бэкенд-приложения FastAPI
│   ├── venv/            # Виртуальное окружение Python
│   ├── database.py      # Настройка подключения к БД SQLAlchemy
│   ├── models.py        # ORM модели для SQLAlchemy
│   ├── schemas.py       # Pydantic схемы для валидации данных API
│   ├── crud.py          # Функции для CRUD операций с БД
│   ├── main.py          # Основное приложение FastAPI, маршруты API, CORS, логирование, JWT
│   ├── backup_db.py     # Скрипт для резервного копирования БД
│   ├── schedule_backup.ps1 # PowerShell скрипт для планирования резервного копирования (Windows)
│   └── tests/           # Модульные и интеграционные тесты для бэкенда
│       ├── __init__.py
│       ├── test_crud.py
│       └── test_main.py
├── frontend/            # Каталог фронтенд-приложения Next.js
│   ├── node_modules/    # Зависимости Node.js
│   ├── public/          # Статические файлы
│   ├── src/             # Исходный код фронтенда
│   │   ├── app/         # App Router Next.js
│   │   │   ├── api/     # Клиенты для взаимодействия с Backend API
│   │   │   ├── components/ # Переиспользуемые React компоненты (AuthGuard)
│   │   │   ├── context/ # Контекст React (AuthContext)
│   │   │   ├── login/   # Страница входа
│   │   │   ├── register/ # Страница регистрации
│   │   │   ├── globals.scss # Глобальные стили SCSS
│   │   │   ├── layout.tsx # Корневой макет Next.js
│   │   │   ├── page.tsx   # Главная страница / Дашборд
│   │   │   └── types.ts   # TypeScript интерфейсы для данных
│   │   └── styles/    # SCSS-модули
│   ├── .env.local       # Переменные окружения для фронтенда
│   ├── next.config.ts   # Конфигурация Next.js
│   ├── package.json     # Определение проекта Next.js, скрипты и зависимости
│   └── README.md        # README для фронтенда
└── docs/                # Документация проекта
    ├── analysis/        # Документы этапа анализа (Use Cases, User Stories, SRS)
    ├── design/          # Документы этапа проектирования (Архитектура, ER-диаграмма, Прототипы)
    └── testing/         # Документы этапа тестирования (План тестирования)

```

## Инструкции по установке и запуску

### 1. Клонирование репозитория

```bash
git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
cd <НАЗВАНИЕ_ВАШЕЙ_ПАПКИ_ПРОЕКТА>
```

### 2. Запуск бэкенда (FastAPI)

1.  **Перейдите в каталог `backend`:**

    ```bash
    cd backend
    ```

2.  **Создайте и активируйте виртуальное окружение (если ещё не создано):**

    ```bash
    python -m venv venv
    # Для Windows:
    .\venv\Scripts\activate
    # Для macOS/Linux:
    source venv/bin/activate
    ```

3.  **Установите зависимости Python:**

    ```bash
    pip install -r requirements.txt
    # Если файла requirements.txt нет, создайте его:
    # pip freeze > requirements.txt
    # Затем установите:
    # pip install -r requirements.txt
    ```
    *Примечание:* После установки `openpyxl` вам может потребоваться обновить `requirements.txt`.

4.  **Запустите FastAPI-приложение:**

    ```bash
    uvicorn backend.main:app --reload
    ```
    Бэкенд будет доступен по адресу `http://localhost:8000` (или другому порту, если указано).

5.  **Настройка ежедневного резервного копирования (только для Windows):**
    Вы можете использовать "Планировщик заданий" Windows для запуска `backend/schedule_backup.ps1` ежедневно.
    Создайте новую задачу, которая запускает PowerShell со следующими аргументами:

    ```
    -ExecutionPolicy Bypass -File "<ПОЛНЫЙ_ПУТЬ_К_ВАШЕМУ_ПРОЕКТУ>\backend\schedule_backup.ps1"
    ```

### 2.5. Контроль покрытия кода тестами (Backend)

1.  **Установите `coverage.py` (если ещё не установлен):**

    ```bash
    pip install coverage
    ```

2.  **Запустите тесты с отчетом о покрытии:**

    ```bash
    cd backend
    coverage run -m pytest tests/
    coverage report -m
    # Для создания интерактивного HTML-отчета:
    coverage html
    # Отчет будет доступен в каталоге htmlcov/
    cd ..
    ```

### 2.6. Контроль доступа к логам

Логи системы (например, `app.log` в каталоге `backend`) могут содержать конфиденциальную информацию. Необходимо обеспечить строгий контроль доступа к ним.

*   **Права доступа к файлам:** На сервере развертывания убедитесь, что файлы логов имеют ограниченные права доступа. Только уполномоченные пользователи или системные учетные записи должны иметь возможность чтения и записи в эти файлы.
*   **Ролевой доступ:** В идеале доступ к просмотру логов должен быть ограничен системным администраторам или ролям с соответствующими привилегиями. В рамках текущего монолитного приложения, это может быть реализовано на уровне ОС или через специализированные инструменты управления логами.
*   **Ротация логов:** Настройте ротацию логов, чтобы предотвратить переполнение диска и упростить управление старыми логами.

### 3. Запуск фронтенда (Next.js)

1.  **Перейдите в каталог `frontend`:**

    ```bash
    cd ../frontend
    ```

2.  **Установите зависимости Node.js:**

    ```bash
    npm install
    # или yarn install, pnpm install
    ```

3.  **Создайте файл `.env.local`** в каталоге `frontend` со следующим содержимым:

    ```env
    NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
    ```

4.  **Запустите Next.js приложение:**

    ```bash
    npm run dev
    ```
    Фронтенд будет доступен по адресу `http://localhost:3000`.

### 4. Развертывание с использованием Docker Compose

Для упрощения развертывания и управления, бэкенд и фронтенд могут быть запущены в контейнерах с помощью Docker Compose.

1.  **Убедитесь, что Docker и Docker Compose установлены** в вашей системе.

2.  **Перейдите в корневой каталог проекта** (где находится `docker-compose.yml`):

    ```bash
    cd <НАЗВАНИЕ_ВАШЕЙ_ПАПКИ_ПРОЕКТА>
    ```

3.  **Запустите сервисы:**

    ```bash
    docker-compose up --build -d
    ```
    *   `--build`: Пересобирает образы перед запуском (используйте при изменении Dockerfile).
    *   `-d`: Запускает контейнеры в фоновом режиме.

4.  **Проверка статуса сервисов:**

    ```bash
    docker-compose ps
    ```

5.  **Доступ к приложению:**

    *   Бэкенд: `http://localhost:8000`
    *   Фронтенд: `http://localhost:3000` (если сервис фронтенда будет добавлен в `docker-compose.yml`)

6.  **Остановка сервисов:**

    ```bash
    docker-compose down
    ```

### 5. Обучение пользователей

Эффективное обучение пользователей является ключевым фактором для успешного внедрения системы. Обучение должно включать:

*   **Обзор функциональности:** Знакомство с основными возможностями системы (управление проектами, дефектами, отчетность).
*   **Работа с интерфейсом:** Демонстрация навигации, заполнения форм, использования фильтров и поиска.
*   **Ролевые особенности:** Объяснение специфики работы для каждой роли (Менеджер, Инженер, Наблюдатель).
*   **Практические задания:** Выполнение реальных сценариев для закрепления материала.

Для обучения может быть использована [Пользовательская документация](docs/deployment/user_documentation.md).

### 6. Приёмка системы и опытная эксплуатация

После завершения разработки и тестирования система готова к приёмке и опытной эксплуатации.

*   **Официальная приёмка:** Проведение формальной приёмки системы с участием заказчика, на основе утвержденных SRS и User Stories.
*   **Запуск в опытную эксплуатацию:** Развертывание системы на реальной инфраструктуре заказчика для использования ограниченной группой пользователей.
*   **Сбор обратной связи:** Активный сбор отзывов от пользователей в ходе опытной эксплуатации для выявления возможных проблем и предложений по улучшению.
*   **Исправление критических дефектов:** Оперативное устранение всех критических дефектов, выявленных во время опытной эксплуатации.

## Дальнейшее развитие

*   Доработка UI/UX фронтенда.
*   Реализация более сложных аналитических отчетов.
*   Настройка развертывания (деплоя).
*   Добавление CI/CD конвейера.
*   Масштабирование базы данных (при необходимости переход с SQLite на PostgreSQL/MySQL).

