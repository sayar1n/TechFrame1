{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/koshk/OneDrive/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B/%D0%A4%D1%80%D0%B5%D0%B9%D0%BC%D0%BE%D0%B2%D0%BE%D1%80%D0%BA%D0%B8/1/frontend/src/app/utils/api.ts"],"sourcesContent":["import axios from 'axios';\r\nimport { UserCreate, UserLogin, User, Token, Project, ProjectCreate, Defect, DefectCreate, Comment, CommentCreate, Attachment, AnalyticsSummary, DefectCountByStatus, DefectCountByPriority, DefectCreationTrendItem, ProjectPerformanceItem } from '@/app/types';\r\n\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:8000';\r\n\r\nexport const apiClient = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\nexport const loginUser = async (userData: UserLogin): Promise<Token> => {\r\n  const response = await apiClient.post(\r\n    '/token',\r\n    new URLSearchParams({\r\n      username: userData.username,\r\n      password: userData.password,\r\n    }),\r\n    {\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n    }\r\n  );\r\n  return response.data;\r\n};\r\n\r\nexport const registerUser = async (userData: UserCreate): Promise<User> => {\r\n  const response = await apiClient.post('/register/', userData);\r\n  return response.data;\r\n};\r\n\r\nexport const fetchCurrentUser = async (token: string): Promise<User> => {\r\n  const response = await apiClient.get('/users/me/', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const createProject = async (token: string, userId: number, projectData: ProjectCreate): Promise<Project> => {\r\n  const response = await apiClient.post(`/users/${userId}/projects/`, projectData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const updateProject = async (token: string, projectId: number, projectData: ProjectCreate): Promise<Project> => {\r\n  const response = await apiClient.put(`/projects/${projectId}`, projectData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const deleteProject = async (token: string, projectId: number): Promise<void> => {\r\n  await apiClient.delete(`/projects/${projectId}`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n};\r\n\r\nexport const fetchProjectById = async (token: string, projectId: number): Promise<Project> => {\r\n  const response = await apiClient.get(`/projects/${projectId}`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchDefectById = async (token: string, defectId: number): Promise<Defect> => {\r\n  const response = await apiClient.get(`/defects/${defectId}`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchProjects = async (token: string): Promise<Project[]> => {\r\n  const response = await apiClient.get('/projects/', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchDefects = async (token: string): Promise<Defect[]> => {\r\n  const response = await apiClient.get('/defects/', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const createDefect = async (token: string, defectData: DefectCreate): Promise<Defect> => {\r\n  const response = await apiClient.post('/defects/', defectData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const updateDefect = async (token: string, defectId: number, defectData: DefectCreate): Promise<Defect> => {\r\n  const response = await apiClient.put(`/defects/${defectId}`, defectData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const deleteDefect = async (token: string, defectId: number): Promise<void> => {\r\n  await apiClient.delete(`/defects/${defectId}`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n};\r\n\r\nexport const fetchCommentsForDefect = async (token: string, defectId: number): Promise<Comment[]> => {\r\n  const response = await apiClient.get(`/defects/${defectId}/comments/`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const createComment = async (token: string, defectId: number, commentData: CommentCreate): Promise<Comment> => {\r\n  const response = await apiClient.post(`/defects/${defectId}/comments/`, commentData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchAttachmentsForDefect = async (token: string, defectId: number): Promise<Attachment[]> => {\r\n  const response = await apiClient.get(`/defects/${defectId}/attachments/`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const uploadAttachment = async (token: string, defectId: number, file: File): Promise<Attachment> => {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  const response = await apiClient.post(`/defects/${defectId}/attachments/`, formData, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n      'Content-Type': 'multipart/form-data',\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const deleteAttachment = async (token: string, defectId: number, attachmentId: number): Promise<void> => {\r\n  await apiClient.delete(`/defects/${defectId}/attachments/${attachmentId}`, {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n};\r\n\r\nexport const fetchUsers = async (token: string): Promise<User[]> => {\r\n  const response = await apiClient.get('/admin/users/', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const updateUserRole = async (token: string, userId: number, newRole: \"manager\" | \"engineer\" | \"observer\"): Promise<User> => {\r\n  const response = await apiClient.put(\r\n    `/users/${userId}/role`,\r\n    { new_role: newRole }, // Отправляем объект с полем new_role\r\n    {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    }\r\n  );\r\n  return response.data;\r\n};\r\n\r\nexport const exportDefectsToCsvExcel = async (token: string, format: \"csv\" | \"xlsx\", filters?: Record<string, any>): Promise<Blob> => {\r\n  const response = await apiClient.get('/reports/defects/export', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: { format, ...filters },\r\n    responseType: 'blob', // Важно для получения бинарных данных файла\r\n  });\r\n  return response.data;\r\n};\r\n\r\n// Analytics API functions\r\nexport const fetchAnalyticsSummary = async (token: string, startDate?: string, endDate?: string): Promise<AnalyticsSummary> => {\r\n  const params = { start_date: startDate, end_date: endDate };\r\n  const response = await apiClient.get('/reports/analytics/summary', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: params,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchStatusDistribution = async (token: string, startDate?: string, endDate?: string): Promise<DefectCountByStatus[]> => {\r\n  const params = { start_date: startDate, end_date: endDate };\r\n  const response = await apiClient.get('/reports/analytics/status-distribution', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: params,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchPriorityDistribution = async (token: string, startDate?: string, endDate?: string): Promise<DefectCountByPriority[]> => {\r\n  const params = { start_date: startDate, end_date: endDate };\r\n  const response = await apiClient.get('/reports/analytics/priority-distribution', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: params,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchCreationTrend = async (token: string, days: number = 30): Promise<DefectCreationTrendItem[]> => {\r\n  const params = { days: days };\r\n  const response = await apiClient.get('/reports/analytics/creation-trend', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: params,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const fetchProjectPerformance = async (token: string, startDate?: string, endDate?: string): Promise<ProjectPerformanceItem[]> => {\r\n  const params = { start_date: startDate, end_date: endDate };\r\n  const response = await apiClient.get('/reports/analytics/project-performance', {\r\n    headers: {\r\n      Authorization: `Bearer ${token}`,\r\n    },\r\n    params: params,\r\n  });\r\n  return response.data;\r\n};\r\n\r\n// Добавляем интерцептор для автоматического добавления токена к запросам\r\napiClient.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem('access_token');\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\napiClient.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    if (error.response) {\r\n      // Сервер ответил со статусом, отличным от 2xx\r\n      console.error('API Error Response Data:', JSON.stringify(error.response.data, null, 2));\r\n      console.error('API Error Status:', error.response.status);\r\n      console.error('API Error Headers:', error.response.headers);\r\n    } else if (error.request) {\r\n      // Запрос был сделан, но ответа не получено\r\n      console.error('API Error Request:', error.request);\r\n    } else {\r\n      // Что-то пошло не так при настройке запроса\r\n      console.error('Error Message:', error.message);\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGqB;AAHrB;;AAGA,MAAM,eAAe,6DAAwC;AAEtD,MAAM,YAAY,+JAAK,CAAC,MAAM,CAAC;IACpC,SAAS;IACT,SAAS;QACP,gBAAgB;IAClB;AACF;AAEO,MAAM,YAAY,OAAO;IAC9B,MAAM,WAAW,MAAM,UAAU,IAAI,CACnC,UACA,IAAI,gBAAgB;QAClB,UAAU,SAAS,QAAQ;QAC3B,UAAU,SAAS,QAAQ;IAC7B,IACA;QACE,SAAS;YACP,gBAAgB;QAClB;IACF;IAEF,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,cAAc;IACpD,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,mBAAmB,OAAO;IACrC,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,cAAc;QACjD,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO,OAAe,QAAgB;IACjE,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,CAAC,OAAO,EAAE,OAAO,UAAU,CAAC,EAAE,aAAa;QAC/E,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO,OAAe,WAAmB;IACpE,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,WAAW,EAAE,aAAa;QAC1E,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO,OAAe;IACjD,MAAM,UAAU,MAAM,CAAC,CAAC,UAAU,EAAE,WAAW,EAAE;QAC/C,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;AACF;AAEO,MAAM,mBAAmB,OAAO,OAAe;IACpD,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,UAAU,EAAE,WAAW,EAAE;QAC7D,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,kBAAkB,OAAO,OAAe;IACnD,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,SAAS,EAAE,UAAU,EAAE;QAC3D,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO;IAClC,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,cAAc;QACjD,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,aAAa;QAChD,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO,OAAe;IAChD,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,aAAa,YAAY;QAC7D,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO,OAAe,UAAkB;IAClE,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,SAAS,EAAE,UAAU,EAAE,YAAY;QACvE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,eAAe,OAAO,OAAe;IAChD,MAAM,UAAU,MAAM,CAAC,CAAC,SAAS,EAAE,UAAU,EAAE;QAC7C,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;AACF;AAEO,MAAM,yBAAyB,OAAO,OAAe;IAC1D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,SAAS,EAAE,SAAS,UAAU,CAAC,EAAE;QACrE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,gBAAgB,OAAO,OAAe,UAAkB;IACnE,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,CAAC,SAAS,EAAE,SAAS,UAAU,CAAC,EAAE,aAAa;QACnF,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,4BAA4B,OAAO,OAAe;IAC7D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,CAAC,SAAS,EAAE,SAAS,aAAa,CAAC,EAAE;QACxE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,mBAAmB,OAAO,OAAe,UAAkB;IACtE,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,QAAQ;IAExB,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,CAAC,SAAS,EAAE,SAAS,aAAa,CAAC,EAAE,UAAU;QACnF,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;YAChC,gBAAgB;QAClB;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,mBAAmB,OAAO,OAAe,UAAkB;IACtE,MAAM,UAAU,MAAM,CAAC,CAAC,SAAS,EAAE,SAAS,aAAa,EAAE,cAAc,EAAE;QACzE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;AACF;AAEO,MAAM,aAAa,OAAO;IAC/B,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,iBAAiB;QACpD,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,iBAAiB,OAAO,OAAe,QAAgB;IAClE,MAAM,WAAW,MAAM,UAAU,GAAG,CAClC,CAAC,OAAO,EAAE,OAAO,KAAK,CAAC,EACvB;QAAE,UAAU;IAAQ,GACpB;QACE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IAEF,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,0BAA0B,OAAO,OAAe,QAAwB;IACnF,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,2BAA2B;QAC9D,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;YAAE;YAAQ,GAAG,OAAO;QAAC;QAC7B,cAAc;IAChB;IACA,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,wBAAwB,OAAO,OAAe,WAAoB;IAC7E,MAAM,SAAS;QAAE,YAAY;QAAW,UAAU;IAAQ;IAC1D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,8BAA8B;QACjE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;IACV;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,0BAA0B,OAAO,OAAe,WAAoB;IAC/E,MAAM,SAAS;QAAE,YAAY;QAAW,UAAU;IAAQ;IAC1D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,0CAA0C;QAC7E,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;IACV;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,4BAA4B,OAAO,OAAe,WAAoB;IACjF,MAAM,SAAS;QAAE,YAAY;QAAW,UAAU;IAAQ;IAC1D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,4CAA4C;QAC/E,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;IACV;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,qBAAqB,OAAO,OAAe,OAAe,EAAE;IACvE,MAAM,SAAS;QAAE,MAAM;IAAK;IAC5B,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,qCAAqC;QACxE,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;IACV;IACA,OAAO,SAAS,IAAI;AACtB;AAEO,MAAM,0BAA0B,OAAO,OAAe,WAAoB;IAC/E,MAAM,SAAS;QAAE,YAAY;QAAW,UAAU;IAAQ;IAC1D,MAAM,WAAW,MAAM,UAAU,GAAG,CAAC,0CAA0C;QAC7E,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;QACA,QAAQ;IACV;IACA,OAAO,SAAS,IAAI;AACtB;AAEA,yEAAyE;AACzE,UAAU,YAAY,CAAC,OAAO,CAAC,GAAG,CAChC,CAAC;IACC,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT,GACA,CAAC;IACC,OAAO,QAAQ,MAAM,CAAC;AACxB;AAGF,UAAU,YAAY,CAAC,QAAQ,CAAC,GAAG,CACjC,CAAC,WAAa,UACd,CAAC;IACC,IAAI,MAAM,QAAQ,EAAE;QAClB,8CAA8C;QAC9C,QAAQ,KAAK,CAAC,4BAA4B,KAAK,SAAS,CAAC,MAAM,QAAQ,CAAC,IAAI,EAAE,MAAM;QACpF,QAAQ,KAAK,CAAC,qBAAqB,MAAM,QAAQ,CAAC,MAAM;QACxD,QAAQ,KAAK,CAAC,sBAAsB,MAAM,QAAQ,CAAC,OAAO;IAC5D,OAAO,IAAI,MAAM,OAAO,EAAE;QACxB,2CAA2C;QAC3C,QAAQ,KAAK,CAAC,sBAAsB,MAAM,OAAO;IACnD,OAAO;QACL,4CAA4C;QAC5C,QAAQ,KAAK,CAAC,kBAAkB,MAAM,OAAO;IAC/C;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB"}},
    {"offset": {"line": 340, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/koshk/OneDrive/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B/%D0%A4%D1%80%D0%B5%D0%B9%D0%BC%D0%BE%D0%B2%D0%BE%D1%80%D0%BA%D0%B8/1/frontend/src/app/context/AuthContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { createContext, useState, useEffect, useContext, ReactNode } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { loginUser, registerUser, fetchCurrentUser } from '@/app/utils/api';\r\nimport { User, UserLogin, UserCreate, Token } from '@/app/types';\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  token: string | null;\r\n  login: (username: string, password: string) => Promise<void>;\r\n  register: (userData: UserCreate) => Promise<void>;\r\n  logout: () => void;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState<boolean>(true);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    const loadUserFromStorage = async () => {\r\n      try {\r\n        const storedToken = localStorage.getItem('access_token');\r\n\r\n        if (storedToken) {\r\n          setToken(storedToken);\r\n          const fetchedUser = await fetchCurrentUser(storedToken);\r\n          setUser(fetchedUser);\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to load user from storage:', error);\r\n        logout(); // Выходим, если токен недействителен или ошибка\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    loadUserFromStorage();\r\n  }, []);\r\n\r\n  const login = async (username: string, password: string) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response: Token = await loginUser({ username, password });\r\n      setToken(response.access_token);\r\n      localStorage.setItem('access_token', response.access_token);\r\n\r\n      const fetchedUser = await fetchCurrentUser(response.access_token);\r\n      setUser(fetchedUser);\r\n      router.push('/');\r\n    } catch (error) {\r\n      console.error('Login failed:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const register = async (userData: UserCreate) => {\r\n    setIsLoading(true);\r\n    try {\r\n      // На бэкенде роль принудительно устанавливается в \"observer\"\r\n      const newUser = await registerUser({ ...userData, role: \"observer\" });\r\n      router.push('/login');\r\n      return newUser;\r\n    } catch (error) {\r\n      console.error('Registration failed:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    setUser(null);\r\n    localStorage.removeItem('access_token');\r\n    router.push('/login');\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, login, register, logout, isLoading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AAgBA,MAAM,4BAAc,IAAA,0LAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,qLAAQ,EAAc;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,qLAAQ,EAAgB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,qLAAQ,EAAU;IACpD,MAAM,SAAS,IAAA,8JAAS;IAExB,IAAA,sLAAS;kCAAC;YACR,MAAM;8DAAsB;oBAC1B,IAAI;wBACF,MAAM,cAAc,aAAa,OAAO,CAAC;wBAEzC,IAAI,aAAa;4BACf,SAAS;4BACT,MAAM,cAAc,MAAM,IAAA,6JAAgB,EAAC;4BAC3C,QAAQ;wBACV;oBACF,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,qCAAqC;wBACnD,UAAU,gDAAgD;oBAC5D,SAAU;wBACR,aAAa;oBACf;gBACF;;YACA;QACF;iCAAG,EAAE;IAEL,MAAM,QAAQ,OAAO,UAAkB;QACrC,aAAa;QACb,IAAI;YACF,MAAM,WAAkB,MAAM,IAAA,sJAAS,EAAC;gBAAE;gBAAU;YAAS;YAC7D,SAAS,SAAS,YAAY;YAC9B,aAAa,OAAO,CAAC,gBAAgB,SAAS,YAAY;YAE1D,MAAM,cAAc,MAAM,IAAA,6JAAgB,EAAC,SAAS,YAAY;YAChE,QAAQ;YACR,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,MAAM;QACR,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,WAAW,OAAO;QACtB,aAAa;QACb,IAAI;YACF,6DAA6D;YAC7D,MAAM,UAAU,MAAM,IAAA,yJAAY,EAAC;gBAAE,GAAG,QAAQ;gBAAE,MAAM;YAAW;YACnE,OAAO,IAAI,CAAC;YACZ,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;YACtC,MAAM;QACR,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,SAAS;QACb,SAAS;QACT,QAAQ;QACR,aAAa,UAAU,CAAC;QACxB,OAAO,IAAI,CAAC;IACd;IAEA,qBACE,yMAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAO;YAAO;YAAU;YAAQ;QAAU;kBAC5E;;;;;;AAGP;GAvEa;;QAII,8JAAS;;;KAJb;AAyEN,MAAM,UAAU;;IACrB,MAAM,UAAU,IAAA,uLAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa"}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/koshk/OneDrive/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B/%D0%A4%D1%80%D0%B5%D0%B9%D0%BC%D0%BE%D0%B2%D0%BE%D1%80%D0%BA%D0%B8/1/frontend/src/app/components/ClientHeaderWrapper.tsx"],"sourcesContent":["'use client';\r\n\r\nimport dynamic from 'next/dynamic';\r\n\r\nconst Header = dynamic(() => import('@/app/components/Header'), { ssr: false });\r\n\r\nconst ClientHeaderWrapper = () => {\r\n  return <Header />;\r\n};\r\n\r\nexport default ClientHeaderWrapper;\r\n"],"names":[],"mappings":";;;;;AAEA;;AAFA;;;AAIA,MAAM,SAAS,IAAA,yLAAO,EAAC;;;;;;IAA2C,KAAK;;KAAjE;AAEN,MAAM,sBAAsB;IAC1B,qBAAO,yMAAC;;;;;AACV;MAFM;uCAIS"}}]
}